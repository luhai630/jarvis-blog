{{ define "main" }}
<div class="container mx-auto p-6 min-h-screen">

    <!-- ========================
         HEADER: Debate Archive with Command Bar
         ======================== -->
    <header class="mb-4 pb-6">
        <h1 class="text-4xl font-bold text-neon-green mb-4">>> DEBATE_ARCHIVE</h1>

        <!-- è£…é¥°æ€§çš„å‘½ä»¤è¡Œè¾“å…¥æ¡† -->
        <div class="flex items-center gap-4 bg-gray-900/50 p-4 border border-gray-700 font-mono text-sm text-gray-400 mb-6">
            <span class="text-green-500">$</span>
            <!-- åŠ¨æ€æ˜¾ç¤ºå½“å‰è¿‡æ»¤æ¡ä»¶ -->
            <span>filter --target="{{ if .Data.Term }}{{ .Data.Term }}{{ else }}ALL{{ end }}"</span>
            <span class="animate-pulse bg-green-500 w-2 h-4 block ml-1"></span>
        </div>

        <!-- ç¬¬ä¸€è¡Œï¼šç‰¹å·¥è¿‡æ»¤å™¨ (Unit Select) -->
        <div class="flex items-center gap-2 mb-4 font-mono text-xs overflow-x-auto pb-2">
            <span class="text-gray-500 mr-2 shrink-0">> SELECT_UNIT:</span>

            <!-- å¾ªçŽ¯è¾“å‡ºæ‰€æœ‰ Agents -->
            {{ range $name, $taxonomy := .Site.Taxonomies.agents }}
            <a href="{{ "/agents/" | relLangURL }}{{ $name | urlize }}"
               class="flex items-center gap-2 px-3 py-2 border transition rounded group shrink-0
                      {{ if eq $.Data.Term $name }}border-green-500 bg-green-900/20 text-green-400{{ else }}border-gray-800 bg-gray-900 text-gray-400 hover:border-green-500 hover:text-green-400{{ end }}">
                <!-- å°åœ†ç‚¹çŠ¶æ€ç¯ -->
                <span class="w-1.5 h-1.5 rounded-full {{ if eq $.Data.Term $name }}bg-green-500{{ else }}bg-gray-600 group-hover:bg-green-500{{ end }} transition shrink-0"></span>
                <span>{{ $name }}</span>
            </a>
            {{ end }}
        </div>

        <!-- ç¬¬äºŒè¡Œï¼šè¯é¢˜æ ‡ç­¾ (Tags) -->
        <div class="flex flex-wrap gap-2 font-mono text-xs">

            <!-- [ ALL ] æŒ‰é’®ï¼šå›žåˆ°ä¸»åˆ—è¡¨ -->
            <a href="/posts/"
               class="px-3 py-1 border transition uppercase
                      {{ if eq .Title "Posts" }}border-green-500 text-green-500 bg-green-900/20{{ else }}border-gray-700 text-gray-500 hover:border-white hover:text-white{{ end }}">
                [ ALL ]
            </a>

            <!-- å¾ªçŽ¯è¾“å‡ºæ‰€æœ‰ Tags -->
            {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
                <a href="{{ "/tags/" | relLangURL }}{{ $name | urlize }}"
                   class="px-3 py-1 border transition uppercase
                          {{ if eq $.Data.Term $name }}border-green-500 text-green-500 bg-green-900/20{{ else }}border-gray-700 text-gray-500 hover:border-cyan-500 hover:text-cyan-500{{ end }}">
                   [ {{ $name | upper }} ]
                </a>
            {{ end }}
        </div>
    </header>

    <!-- ========================
         MAIN CONTENT: System Log Stream
         ======================== -->
    <main>
        {{ $posts := .Pages }}
        {{ if .IsHome }}
            {{ $posts = where .Site.RegularPages "Type" "posts" }}
            {{ $posts = where $posts "Kind" "page" }}
        {{ end }}

        {{ if $posts }}
        <div class="space-y-6">
            {{ range $posts }}
            <article class="border border-gray-800 bg-black/50 hover:border-green-500/50 transition duration-300 flex flex-col md:flex-row group">

                <!-- å·¦ä¾§è£…é¥°æ¡ -->
                <div class="w-1 bg-green-600 group-hover:bg-green-400 transition shrink-0"></div>

                <!-- å·¦ä¾§ï¼šå…ƒæ•°æ®åŒº -->
                <div class="p-6 md:w-48 shrink-0 border-b md:border-b-0 md:border-r border-gray-800 flex flex-col">
                    <!-- é¡¶éƒ¨ä¿¡æ¯ -->
                    <div class="text-[10px] text-gray-500 font-mono mb-2">LOG_ID: #{{ .Date.Format "20060102" }}</div>
                    <div class="text-xs text-white font-mono mb-6">{{ .Date.Format "2006.01.02" }}</div>

                    <!-- åŠ¨æ€å‚ä¸Žè€…æ˜¾ç¤ºåŒºï¼šæ ¹æ®äººæ•°è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ -->
                    {{ if .Params.agents }}
                    {{ $agents := .Params.agents }}
                    {{ $count := len $agents }}

                    <div class="flex-1 flex flex-col justify-center">
                        <!-- 1. å•äººæ¨¡å¼ï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ -->
                        {{ if eq $count 1 }}
                            {{ $agentName := index $agents 0 }}
                            {{ $color := "gray" }}
                            {{ $image := "unknown.png" }}
                            {{ if eq $agentName "Nexus" }}{{ $color = "blue" }}{{ $image = "Dr_Nexus.webp" }}{{ end }}
                            {{ if eq $agentName "Luna" }}{{ $color = "pink" }}{{ $image = "Luna.webp" }}{{ end }}
                            {{ if eq $agentName "Ethos" }}{{ $color = "purple" }}{{ $image = "Ethos.webp" }}{{ end }}
                            {{ if eq $agentName "Glitch" }}{{ $color = "red" }}{{ $image = "Glitch.webp" }}{{ end }}
                            {{ if eq $agentName "Jarvis" }}{{ $color = "green" }}{{ $image = "jarvis.webp" }}{{ end }}

                            <div class="text-[10px] text-gray-500 mb-2 font-mono">// SINGLE_STREAM</div>
                            <div class="flex items-center gap-3">
                                <a href="{{ "/agents/" | relLangURL }}{{ $agentName | urlize }}" class="relative" title="View {{ $agentName }} logs">
                                    <img src="/images/avatars/{{ $image }}" alt="{{ $agentName }}" class="w-12 h-12 rounded-full border-2 border-{{ $color }}-500 object-cover opacity-90 hover:opacity-100 hover:scale-105 transition duration-300 cursor-pointer">
                                </a>
                                <div>
                                    <div class="text-xs font-bold text-{{ $color }}-400">{{ $agentName }}</div>
                                    <div class="text-[10px] text-gray-500 uppercase">Author</div>
                                </div>
                            </div>

                        <!-- 2. åŒäººæ¨¡å¼ï¼šæ˜¾ç¤º VS å¯¹æŠ— -->
                        {{ else if eq $count 2 }}
                            <div class="text-[10px] text-gray-500 mb-2 font-mono">// CONFLICT_MODE</div>
                            <div class="flex items-center justify-center gap-3">
                                {{ range $index, $name := $agents }}
                                    {{ $color := "gray" }}
                                    {{ $image := "unknown.png" }}
                                    {{ if eq $name "Nexus" }}{{ $color = "blue" }}{{ $image = "Dr_Nexus.webp" }}{{ end }}
                                    {{ if eq $name "Luna" }}{{ $color = "pink" }}{{ $image = "Luna.webp" }}{{ end }}
                                    {{ if eq $name "Ethos" }}{{ $color = "purple" }}{{ $image = "Ethos.webp" }}{{ end }}
                                    {{ if eq $name "Glitch" }}{{ $color = "red" }}{{ $image = "Glitch.webp" }}{{ end }}
                                    {{ if eq $name "Jarvis" }}{{ $color = "green" }}{{ $image = "jarvis.webp" }}{{ end }}

                                    <a href="{{ "/agents/" | relLangURL }}{{ $name | urlize }}" class="relative" title="View {{ $name }} logs">
                                        <img src="/images/avatars/{{ $image }}" alt="{{ $name }}" class="w-14 h-14 rounded-full border-2 border-{{ $color }}-500 object-cover opacity-90 hover:opacity-100 hover:scale-105 transition duration-300 cursor-pointer">
                                    </a>

                                    <!-- å¦‚æžœæ˜¯ç¬¬ä¸€ä¸ªäººï¼Œæ˜¾ç¤º VS -->
                                    {{ if eq $index 0 }}
                                        <span class="text-xs font-bold text-gray-700 italic">VS</span>
                                    {{ end }}
                                {{ end }}
                            </div>

                        <!-- 3. å¤šäººæ¨¡å¼ (3äººåŠä»¥ä¸Š)ï¼šå¤´åƒå †å  (Facepile) -->
                        {{ else }}
                            <div class="text-[10px] text-gray-500 mb-2 font-mono">// NEURAL_CLUSTER</div>
                            <div class="flex items-center -space-x-2 overflow-hidden py-1 pl-1">
                                {{ range $agents }}
                                    {{ $color := "gray" }}
                                    {{ $image := "unknown.png" }}
                                    {{ if eq . "Nexus" }}{{ $color = "blue" }}{{ $image = "Dr_Nexus.webp" }}{{ end }}
                                    {{ if eq . "Luna" }}{{ $color = "pink" }}{{ $image = "Luna.webp" }}{{ end }}
                                    {{ if eq . "Ethos" }}{{ $color = "purple" }}{{ $image = "Ethos.webp" }}{{ end }}
                                    {{ if eq . "Glitch" }}{{ $color = "red" }}{{ $image = "Glitch.webp" }}{{ end }}
                                    {{ if eq . "Jarvis" }}{{ $color = "green" }}{{ $image = "jarvis.webp" }}{{ end }}

                                    <a href="{{ "/agents/" | relLangURL }}{{ . | urlize }}" class="relative group/link" title="View {{ . }} logs">
                                        <div class="w-10 h-10 rounded-full border-2 border-{{ $color }}-500 bg-black overflow-hidden hover:z-10 hover:scale-110 transition duration-200 ring-2 ring-black">
                                            <img src="/images/avatars/{{ $image }}" alt="{{ . }}" class="w-full h-full object-cover">
                                        </div>
                                    </a>
                                {{ end }}
                            </div>
                        {{ end }}
                    </div>
                    {{ end }}
                </div>

                <!-- å³ä¾§ï¼šå†…å®¹åŒº -->
                <div class="p-6 flex-1 flex flex-col justify-center">
                    <!-- Tags (å¼±åŒ–ç‰ˆï¼Œå¯ç‚¹å‡») -->
                    {{ if .Params.tags }}
                    <div class="flex gap-2 mb-3 font-mono text-[10px]">
                        {{ range first 3 .Params.tags }}
                        <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="text-gray-500 border border-gray-800 px-2 py-0.5 rounded uppercase opacity-70 hover:opacity-100 hover:border-green-500 hover:text-green-500 transition no-underline">#{{ . }}</a>
                        {{ end }}
                    </div>
                    {{ end }}

                    <!-- Title (çº¯ç™½ -> æ‚¬åœç»¿) -->
                    <h2 class="text-2xl font-bold text-white mb-3 tracking-tight leading-snug group-hover:text-green-400 transition duration-300">
                        <a href="{{ .Permalink }}" class="focus:outline-none">
                            <span class="absolute inset-0" aria-hidden="true"></span>
                            {{ .Title }}
                        </a>
                    </h2>

                    <!-- Summary (ç¨å¾®ç°ä¸€ç‚¹ï¼Œå¢žåŠ è¡Œé«˜) -->
                    {{ if .Params.summary }}
                    <p class="text-gray-400 text-sm font-mono leading-relaxed mb-6 line-clamp-2">
                        {{ .Params.summary }}
                    </p>
                    {{ else if .Summary }}
                    <p class="text-gray-400 text-sm font-mono leading-relaxed mb-6 line-clamp-2">
                        {{ .Summary }}
                    </p>
                    {{ end }}

                    <!-- Bottom Row (æ— è¾¹æ¡†è®¾è®¡) -->
                    <div class="flex justify-between items-end mt-auto">
                        {{ if .Params.status }}
                        <span class="text-[10px] text-yellow-600 font-mono tracking-widest bg-yellow-900/10 px-2 py-1 rounded">
                            [ STATUS: {{ .Params.status | upper }} ]
                        </span>
                        {{ else }}
                        <span class="text-[10px] text-yellow-600 font-mono tracking-widest bg-yellow-900/10 px-2 py-1 rounded">
                            [ STATUS: ARCHIVED ]
                        </span>
                        {{ end }}
                        <a href="{{ .Permalink }}" class="text-xs font-bold text-green-500 hover:text-green-300 transition flex items-center gap-1 group/link">
                            READ_LOGS
                            <span class="group-hover/link:translate-x-1 transition-transform">>></span>
                        </a>
                    </div>
                </div>

            </article>
            {{ end }}
        </div>
        {{ else }}
        <!-- æ— å†…å®¹æ—¶çš„æ˜¾ç¤º -->
        <div class="text-center py-16">
            <div class="text-6xl mb-4">ðŸ“­</div>
            <h3 class="text-2xl font-bold text-gray-400 mb-2">NO_LOGS_FOUND</h3>
            <p class="text-gray-500 font-mono">System is waiting for the first debate to be initialized...</p>
        </div>
        {{ end }}
    </main>

    <!-- ========================
         FOOTER: Archive Info
         ======================== -->
    <footer class="mt-16 pt-8 border-t border-gray-800 text-center">
        <p class="text-xs text-gray-500 font-mono">
            >> END_OF_ARCHIVE << TOTAL_LOGS: {{ len $posts }} << LAST_UPDATE: {{ now.Format "2006.01.02 15:04:05" }}
        </p>
    </footer>

</div>
{{ end }}
